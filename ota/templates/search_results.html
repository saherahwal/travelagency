<!DOCTYPE html>
{% extends "base.html" %}

{% block title %}
<title> Online Travel Agency - Results</title>
{% endblock %}
	
{% block body %}
	<!--main-->
	<div class="main" role="main">		
		<div class="wrap clearfix">
			<!--main content-->
			<div class="content clearfix">
				<!--breadcrumbs-->
				<nav role="navigation" class="breadcrumbs clearfix">
					<!--crumbs-->
					<ul class="crumbs">											
						<li><p id="crumbs_p_dest">{{query_dest_trimmed}}</p></li>
						{% if wellness %}
							<li> <p id="crumbs_p_Wellness">Wellness</p> </li>
						{% endif %}
						{% if shopping %}
							<li> <p id="crumbs_p_Wellness">Shopping</p> </li>
						{% endif %}						
						{% if romance %}
							<li> <p id="crumbs_p_Wellness">Romance</p> </li>
						{% endif %}
						{% if clubbing %}
							<li> <p id="crumbs_p_Wellness">Night Life</p> </li>
						{% endif %}
						{% if casinos %}
							<li> <p id="crumbs_p_Wellness">Casinos</p> </li>
						{% endif %}
						{% if adventure %}
							<li> <p id="crumbs_p_Wellness">Adventure</p> </li>
						{% endif %}
						{% if beach_and_sun %}
							<li> <p id="crumbs_p_Wellness">Beach &amp; Sun</p> </li>
						{% endif %}
						{% if family %}
							<li> <p id="crumbs_p_Wellness">Family</p> </li>
						{% endif %}
						{% if skiing %}
							<li> <p id="crumbs_p_Wellness">Skiiing</p> </li>
						{% endif %}
						{% if history_and_culture %}
							<li> <p id="crumbs_p_Wellness">History &amp; Culture</p> </li>
						{% endif %}
						<!-- <li><a href="#" title="United Kingdom">United Kingdom</a></li>
						<li><a href="#" title="London">London</a></li>
						<li>Search results</li> -->                                       
					</ul>
					<!--//crumbs-->
					
					<!--top right navigation-->
					<ul class="top-right-nav">
						<!-- <li><a href="#" title="Back to results">Back to results</a></li> -->
						<li><a href="#" title="Change search">Change search</a></li>
					</ul>
					<!--//top right navigation-->
				</nav>
				<!--//breadcrumbs-->
			
				<!--sidebar-->
				<aside class="left-sidebar">
					<article class="refine-search-results">
						<h2>Refine search results</h2>
						<dl>								
							<!--Star rating-->
							<dt>Star rating</dt>
							<dd>
							{% if stars %}
								<span class="stars-info">{{stars}} or more</span>
							{% endif %}
							{% if not stars %}
								<span class="stars-info">1 or more</span>
							{% endif %}								
								<div id="star" data-rating="1"></div>
							</dd>
							<!--//Star rating-->							
																																			
							<!--Hotel theme-->
							<dt>Hotel theme</dt>
							<dd id="hotel_theme_dd">
								<div class="checkbox">
									<input type="checkbox" id="id_familytheme" name="theme" {% if family %} checked {% endif %}/>
									<label for="id_familytheme">Family Fun</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_adventuretheme" name="theme" {% if adventure %} checked {% endif %}/>
									<label for="id_adventuretheme">Adventure</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_beachtheme" name="theme" {% if beach_and_sun %} checked {% endif %} />
									<label for="id_beachtheme">Beach &amp; Sun</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_casinostheme" name="theme" {% if casinos  %} checked {% endif %}/>
									<label for="id_casinostheme">Casinos</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_historytheme" name="theme" {% if history_and_culture  %} checked {% endif %}/>
									<label for="id_casinostheme">History &amp; Culture</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_clubbingtheme" name="theme" {% if clubbing  %} checked {% endif %} />
									<label for="id_clubbingtheme">Night Life</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_romancetheme" name="theme" {% if romance  %} checked {% endif %}  />
									<label for="id_romancetheme">Romance</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_shoppingtheme" name="theme" {% if shopping  %} checked {% endif %}  />
									<label for="id_shoppingtheme">Shopping</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_skiingtheme" name="theme" {% if skiing  %} checked {% endif %} />
									<label for="id_skiingtheme">Skiing</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="id_wellnesstheme" name="theme" {% if wellness  %} checked {% endif %} />
									<label for="id_wellnesstheme">Wellness</label>
								</div>
								<!-- <div class="checkbox">
									<input type="checkbox" id="ch60" name="theme" />
									<label for="ch60">Eco &amp; Nature</label>
								</div> -->
							</dd>
							<!--//Hotel theme-->							
						</dl>
					</article>
				</aside>
				<!--//sidebar-->
			
				<!--three-fourth content-->
					<section class="three-fourth">
						<div class="sort-by">
							<h3>Sort by</h3>
							<ul class="sort">
								<li>Popularity <a href="#" title="ascending" class="ascending">ascending</a><a href="#" title="descending" class="descending">descending</a></li>
								<li>Price <a href="#" title="ascending" class="ascending">ascending</a><a href="#" title="descending" class="descending">descending</a></li>
								<li>Stars <a href="#" title="ascending" class="ascending">ascending</a><a href="#" title="descending" class="descending">descending</a></li>
								<li>Rating <a href="#" title="ascending" class="ascending">ascending</a><a href="#" title="descending" class="descending">descending</a></li>
							</ul>
							
							<ul class="view-type">
								<li class="grid-view"><a href="#" title="grid view">grid view</a></li>
								<li class="list-view"><a href="#" title="list view">list view</a></li>
								<li class="location-view"><a href="#" title="location view">location view</a></li>
							</ul>
						</div>

						<div class="searchDataForPagination" style="display:none;">
							<p id="saved_destination">{{destination}}</p>
							<p id="saved_interestmap">{{interest_dict}}</p>
							<p id="saved_surpriseme">{{surpriseme}}</p>
						</div>
						
						<div class="deals clearfix" id="resultsSection">

							{% for hotel in hotels %}
								<!--deal-->
								<article class="one-fourth">									
									<figure><a target="_blank" href="{{hotel.hotel.hotel_url}}?aid={{aid}};checkin={{checkin}};checkout={{checkout}};no_rooms={{no_rooms}};req_adults={{req_adults}};req_children={{req_children}}" title="" data-hotel-id="{{hotel.hotel.id}}" ><img src="{{hotel.hotel.photo_url}}" alt="" width="270" height="152"/></a></figure>
									<div class="details">
										<h1>{{hotel.hotel.name}}
											<span class="stars">
											    {% with stars=hotel.hotel.hotel_class|floatformat:"-1" %}
												{% for i in dummy_star_rating|slice:stars %}
													<img id = "{{i}}" src="{{STATIC_URL}}images/ico/star.png" alt="" />
												{% endfor %}
												{% endwith %}												
											</span>
										</h1>
										<span class="address">{{hotel.hotel.city}}  •  <a href="#">Show on map</a></span>
										<span class="rating">{{hotel.total}}</span>
										<!-- <span class="rating"> 8 /10</span>										
										<span class="price">Price per room per night from  <em>$ 50</em> </span> -->
										<div class="description">
											<p>{{hotel.hotel.desc_en}}<a target="_blank" href="{{hotel.hotel.hotel_url}}?aid={{aid}};checkin={{checkin}};checkout={{checkout}};no_rooms={{no_rooms}};req_adults={{req_adults}};req_children={{req_children}}" data-hotel-id="{{hotel.hotel.id}}"> More info</a></p>
										</div>
										<a target="_blank" href="{{hotel.hotel.hotel_url}}?aid={{aid}};checkin={{checkin}};checkout={{checkout}};no_rooms={{no_rooms}};req_adults={{req_adults}};req_children={{req_children}}" title="Book now" class="gradient-button" data-hotel-id="{{hotel.hotel.id}}">Book now</a>
									</div>
								</article>
								<!--//deal-->
							{% endfor %}
							
							<!--bottom navigation-->
							<div class="bottom-nav">
								<!--back up button-->
								<a href="#" class="scroll-to-top" title="Back up">Back up</a> 
								<!--//back up button-->
								
								<!--pager-->								
								<div class="pager">
									<span><a href="/hotels/search/?page=1&{{saved_query}}&destination={{destination}}&stars={{stars}}">First page</a></span>
									<!-- <span><a href="/hotels/search/?page=1&{{saved_query}}&destination={{destination}}">&lt;</a></span> -->
									{% if hotels.has_previous %}
							            <span><a href="/hotels/search/?page={{ hotels.previous_page_number }}&{{saved_query}}&destination={{destination}}&stars={{stars}}">&lt;</a></span>
							        {% endif %}

									{% for i in pageRange %}
										<span><a href="/hotels/search/?page={{i}}&{{saved_query}}&destination={{destination}}&stars={{stars}}">{{i}}</a></span>
									{% endfor %}

									{% if hotels.has_next %}
							            <span><a href="/hotels/search/?page={{ hotels.next_page_number }}&{{saved_query}}&destination={{destination}}&stars={{stars}}">&gt;</a></span>
							        {% endif %}
									
									<!-- <span><a href="/hotels/search/?page=1&{{saved_query}}&destination={{destination}}">&gt;</a></span>-->
									<span><a href="/hotels/search/?page={{hotels.paginator.num_pages}}&{{saved_query}}&destination={{destination}}&stars={{stars}}">Last Page</a></span>						
								</div>								
								
								<!--//pager-->
							</div>
							<!--//bottom navigation-->
						</div>
					</section>
				<!--//three-fourth content-->
			</div>
			<!--//main content-->
		</div>
	</div>
	<!--//main-->
	{% endblock %}
	
	
	{% block tailscripts %}
	<script type="text/javascript">
	$(document).ready(function() {	

		$('dt').each(function() {
			var tis = $(this), state = false, answer = tis.next('dd').hide().css('height','auto').slideUp();
			tis.click(function() {
				state = !state;
				answer.slideToggle(state);
				tis.toggleClass('active',state);
			});
		});
		
		$('.view-type li:first-child').addClass('active');		
		
		$('#star').raty({
			{% if stars %}
			score    : {{stars}},
			{% endif %}
			{% if not stars %}
			score    : 1,
			{% endif %}
			starOff : '{{STATIC_URL}}images/ico/star-rating-off.png',
			starOn  : '{{STATIC_URL}}images/ico/star-rating-on.png',
			click: function(score, evt) {
			//alert('ID: ' + $(this).attr('id') + '\nscore: ' + score + '\nevent: ' + evt);

				window.location = "/hotels/search/?page={{page}}&{{saved_query}}&destination={{destination}}&stars=" + score;
		  }
		});

		hotel_themes = $("#hotel_theme_dd input");

		//
		// get theme filter based on checked
		// themes
		//
		var getThemeFilter = function() {

			var query_str = "";

			$.each( hotel_themes, function(index, value) {

				var checked = $("#"+value.id).is(":checked");

				if (checked && value.id === "id_familytheme") {
					query_str += "family=on&"
				}

				if (checked && value.id === "id_casinostheme") {
					query_str += "casinos=on&"
				}

				if (checked && value.id === "id_shoppingtheme") {
					query_str += "shopping=on&"
				}

				if (checked && value.id === "id_wellnesstheme") {
					query_str += "wellness=on&"
				}

				if (checked && value.id === "id_skiingtheme") {
					query_str += "skiing=on&"
				}

				if (checked && value.id === "id_romancetheme") {
					query_str += "romance=on&"
				}

				if (checked && value.id === "id_beachtheme") {
					query_str += "beachAndSun=on&"
				}

				if (checked && value.id === "id_clubbingtheme") {
					query_str += "nightlife=on&"
				}

				if (checked && value.id === "id_historytheme") {
					query_str += "historyAndCulture=on&"
				}

				if (checked && value.id === "id_adventuretheme") {
					query_str += "adventure=on&"
				}

			});

			return query_str;
		}

		$.each( hotel_themes, function(index, value) {
			
			var input = value;			

			$("#"+input.id).on( "click", function() {

				themes_query = getThemeFilter();
			
				redirect_query = "/hotels/search/?" + themes_query + "&destination={{destination}}&checkInDate={{checkin}}&checkOutDate={{checkout}}";
				
				{% if stars %}
				redirect_query += "&stars={{stars}}";
				{% endif %}

				{% if page %}
				redirect_query += "&page={{page}}";
				{% endif %}

				{% if surpriseme %}
				redirect_query += "&surpriseme=on";
				{% endif %}

				{% if session_guid %}
				redirect_query += "&session_guid={{session_guid}}";
				{% endif %}

				console.log( redirect_query );
				window.location = redirect_query;

			});

		});

		//
		// these are all links getting to booking.com hotels
		//
		hotel_link_results = $("#resultsSection article a");

		$.each( hotel_link_results, function(index, value) {

			// <a> html tag
			var aTag = value;	
			
			aTag.onclick =  function() {
				var hotel_id_attr = aTag.getAttribute("data-hotel-id");
				var session_guid = "{{session_guid}}";
				console.log(hotel_id_attr);
				console.log(session_guid);

				// make ajax request to server with (hotel_id, coorelation id)
				$.ajax({
				  type: "POST",
				  url: "/hotels/book/",
				  datatype: "json",
				  data: { book_hotel_id: hotel_id_attr , 
				  		  book_session_guid: session_guid,
				  		  csrfmiddlewaretoken:'{{csrf_token}}' }
				}).done(function( msg ) {
				    // do nothing				    
				});
			};

		});
		
	});
	
	$(window).load(function () {
		var maxHeight = 0;
			
		$(".three-fourth .one-fourth").each(function(){
			if ($(this).height() > maxHeight) { maxHeight = $(this).height(); }
		});
		$(".three-fourth .one-fourth").height(maxHeight);	
	});	
	</script>
	<script>selectnav('nav'); </script>
	<script type="text/javascript" src="{{STATIC_URL}}js/search_results.js"></script>	
	{% endblock %}
